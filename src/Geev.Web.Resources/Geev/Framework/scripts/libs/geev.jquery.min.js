var geev=geev||{};(function(n){if(n){geev.ajax=function(t){t=t||{};var i=n.extend(!0,{},geev.ajax.defaultOpts,t),r=i.beforeSend;return i.beforeSend=function(n){r&&r(n);n.setRequestHeader("Pragma","no-cache");n.setRequestHeader("Cache-Control","no-cache");n.setRequestHeader("Expires","Sat, 01 Jan 2000 00:00:00 GMT")},i.success=undefined,i.error=undefined,n.Deferred(function(r){n.ajax(i).done(function(n,i,u){n.__geev?geev.ajax.handleResponse(n,t,r,u):(r.resolve(n),t.success&&t.success(n))}).fail(function(n){n.responseJSON&&n.responseJSON.__geev?geev.ajax.handleResponse(n.responseJSON,t,r,n):geev.ajax.handleNonGeevErrorResponse(n,t,r)})})};n.extend(geev.ajax,{defaultOpts:{dataType:"json",type:"POST",contentType:"application/json",headers:{"X-Requested-With":"XMLHttpRequest"}},defaultError:{message:"An error has occurred!",details:"Error detail not sent by server."},defaultError401:{message:"You are not authenticated!",details:"You should be authenticated (sign in) in order to perform this operation."},defaultError403:{message:"You are not authorized!",details:"You are not allowed to perform this operation."},defaultError404:{message:"Resource not found!",details:"The resource requested could not found on the server."},logError:function(n){geev.log.error(n)},showError:function(n){return n.details?geev.message.error(n.details,n.message):geev.message.error(n.message||geev.ajax.defaultError.message)},handleTargetUrl:function(n){location.href=n?n:geev.appPath},handleNonGeevErrorResponse:function(n,t,i){if(t.geevHandleError!==!1)switch(n.status){case 401:geev.ajax.handleUnAuthorizedRequest(geev.ajax.showError(geev.ajax.defaultError401),geev.appPath);break;case 403:geev.ajax.showError(geev.ajax.defaultError403);break;case 404:geev.ajax.showError(geev.ajax.defaultError404);break;default:geev.ajax.showError(geev.ajax.defaultError)}i.reject.apply(this,arguments);t.error&&t.error.apply(this,arguments)},handleUnAuthorizedRequest:function(n,t){n?n.done(function(){geev.ajax.handleTargetUrl(t)}):geev.ajax.handleTargetUrl(t)},handleResponse:function(n,t,i,r){if(n)if(n.success===!0)i&&i.resolve(n.result,n,r),t.success&&t.success(n.result,n,r),n.targetUrl&&geev.ajax.handleTargetUrl(n.targetUrl);else if(n.success===!1){var u=null;n.error?t.geevHandleError!==!1&&(u=geev.ajax.showError(n.error)):n.error=geev.ajax.defaultError;geev.ajax.logError(n.error);i&&i.reject(n.error,r);t.error&&t.error(n.error,r);r.status===401&&t.geevHandleError!==!1&&geev.ajax.handleUnAuthorizedRequest(u,n.targetUrl)}else i&&i.resolve(n,null,r),t.success&&t.success(n,null,r);else i&&i.resolve(r),t.success&&t.success(r)},blockUI:function(n){n.blockUI&&(n.blockUI===!0?geev.ui.setBusy():geev.ui.setBusy(n.blockUI))},unblockUI:function(n){n.blockUI&&(n.blockUI===!0?geev.ui.clearBusy():geev.ui.clearBusy(n.blockUI))},ajaxSendHandler:function(n,t,i){var r=geev.security.antiForgery.getToken();r&&geev.security.antiForgery.shouldSendToken(i)&&(i.headers&&i.headers[geev.security.antiForgery.tokenHeaderName]!==undefined||t.setRequestHeader(geev.security.antiForgery.tokenHeaderName,r))}});n(document).ajaxSend(function(n,t,i){return geev.ajax.ajaxSendHandler(n,t,i)});n.fn.ajaxForm&&(n.fn.geevAjaxForm=function(t){t=t||{};var i=n.extend({},n.fn.geevAjaxForm.defaults,t);return i.beforeSubmit=function(){geev.ajax.blockUI(i);t.beforeSubmit&&t.beforeSubmit.apply(this,arguments)},i.success=function(n){geev.ajax.handleResponse(n,t)},i.complete=function(){geev.ajax.unblockUI(i);t.complete&&t.complete.apply(this,arguments)},this.ajaxForm(i)},n.fn.geevAjaxForm.defaults={method:"POST"});geev.event.on("geev.dynamicScriptsInitialized",function(){geev.ajax.defaultError.message=geev.localization.geevWeb("DefaultError");geev.ajax.defaultError.details=geev.localization.geevWeb("DefaultErrorDetail");geev.ajax.defaultError401.message=geev.localization.geevWeb("DefaultError401");geev.ajax.defaultError401.details=geev.localization.geevWeb("DefaultErrorDetail401");geev.ajax.defaultError403.message=geev.localization.geevWeb("DefaultError403");geev.ajax.defaultError403.details=geev.localization.geevWeb("DefaultErrorDetail403");geev.ajax.defaultError404.message=geev.localization.geevWeb("DefaultError404");geev.ajax.defaultError404.details=geev.localization.geevWeb("DefaultErrorDetail404")})}})(jQuery);